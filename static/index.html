<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>flask-markdown</title>
    <link href="/static/bootstrap.min.css" rel="stylesheet">
    <link href="/static/narrow-jumbotron.css" rel="stylesheet">
    <script>
        const loadArticle = (pathAndHash, articleElement, headerElement, breadcrumbsElement) => {
            const
                hashIndex = pathAndHash.indexOf('#'),
                path = hashIndex >= 0 ? pathAndHash.substring(0, hashIndex) : pathAndHash,
                hash = hashIndex >= 0 ? pathAndHash.substring(pathAndHash.indexOf('#') + 1) : undefined;
            fetch(path || 'index')
                .then(res => res.text())
                .then(text => {
                    const root = document.createElement('div');
                    root.innerHTML = text;
                    headerElement.innerHTML = (root.querySelector('header') || {innerHTML: ''}).innerHTML;
                    articleElement.innerHTML = (root.querySelector('article') || {innerHTML: ''}).innerHTML;
                    document.title = `${headerElement.innerHTML} - alcrea.info`;
                    let dir = path.substring(0, path.lastIndexOf('/'));
                    articleElement.querySelectorAll('a[href]').forEach(a => {
                        let href = a.getAttribute('href');
                        if (href[0] !== '/') href = `${dir}/${href}`;
                        a.setAttribute('href', href === 'index.md' ? '#' : `#${href}`);
                    });
                    breadcrumbsElement.innerHTML = ' /';
                    while(dir) {
                        const breadcrumb = document.createElement('a');
                        breadcrumb.href = `#${dir}/`;
                        breadcrumb.innerText = dir.substring(dir.lastIndexOf('/') + 1);
                        breadcrumbsElement.innerHTML = ' / ' + breadcrumb.outerHTML + breadcrumbsElement.innerHTML;
                        dir = dir.substring(0, dir.lastIndexOf('/'));
                    }
                    const breadcrumb = document.createElement('a');
                    breadcrumb.href = `#`;
                    breadcrumb.innerText = 'alcrea.info';
                    breadcrumbsElement.innerHTML = ' / ' + breadcrumb.outerHTML + breadcrumbsElement.innerHTML;
                    if (hash) {
                        const anchor = articleElement.querySelector(`a[name="${hash}"]`);
                        if (anchor) anchor.scrollIntoView()
                    }

                });
        };

        window.onload = () => {
            const
                articleElement = document.querySelector('article'),
                headerElement = document.querySelector('header'),
                breadcrumbsElement = document.querySelector('div.breadcrumbs'),
                hash = window.location.hash.substring(1) || '';
            window.onpopstate = e => loadArticle(
                window.location.hash.substring(1),
                articleElement,
                headerElement,
                breadcrumbsElement
            );
            history.replaceState({hash: hash}, document.title);
            loadArticle(hash, articleElement, headerElement, breadcrumbsElement);
        };
    </script>
</head>
<body>
<div class="container">
    <div class="page-header">
        <div class="breadcrumbs">/</div>
        <header class="display-3 border-bottom mb-4 pb-4">
        </header>
    </div>
    <div class="content border-bottom mb-4 pb-4">
        <article></article>
    </div>
    <footer class="small text-muted bg-light pt-3 pl-3 pr-3 pb-1  mt-3">
    </footer>
</div>
</body>
</html>

